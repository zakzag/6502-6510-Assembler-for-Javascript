*= $4000
BASE  = 53248
CIM1  = 187
CIM2  = 251
SCREEN = 174
X1    = 172
Y1    = 173
LAP   = 182
CHROUT = 65490
STACK1 = 700
STACK2 = 704
RETRN = 189
SPRITELAP = 190
COLOR = 822
CURSOR = $E50C
GETIN = $FFE4
RSAVE = $FFD8
RLOAD = $FFD5

	LDA #<BREAK
	LDY #>BREAK
	STA 790
	STY 791
	LDY #0
	STY 189
	LDY #76
	STY 84
	LDA #128
	STA 650
	JMP MAIN
HEXA:
	.text "0123456789"
HEXKI:
	STA 2
	LDA X1
	PHA
	LDA Y1
	PHA
	STX X1
	STY Y1
	JSR XYCOMP
	LDY #0
	LDA #"$"
	STA (SCREEN),Y
	INY
	LDA 2
	AND #240
	LSR A
	LSR A
	LSR A
	LSR A
	TAX
	LDA HEXA,X
	STA (SCREEN),Y
	INY
	LDA 2
	AND #15
	TAX
	LDA HEXA,X
	STA (SCREEN),Y
	PLA
	STA Y1
	PLA
	STA X1
	RTS
BYTEKI:
	PHA
	STA 2
	TYA
	PHA
	LDA 2
	LDY #0
	LEP   ROL A
	PHA
	BCS EGY
	LDA #"."
	JMP KI
EGY:
	LDA #"*"
KI:
	STA (251),Y
	PLA
	INY
	CPY #8
	BNE LEP
	PLA
	TAY
	PLA
	RTS
SORKI:
	LDY #0
	LDA (253),Y
	JSR BYTEKI

	CLC
	LDA 251
	ADC #8
	STA 251
	BCC SK1
	INC 252
SK1:
	INY
	LDA (253),Y
	JSR BYTEKI

	CLC
	LDA 251
	ADC #8
	STA 251
	BCC SK2
	INC 252
SK2:
	INY
	LDA (253),Y
	JSR BYTEKI
	CLC
	LDA 251
	ADC #24
	STA 251
	BCC SK3
	INC 252
SK3:
	RTS
SPRITEKI:
	LDA 253
	LDY 254
	STA 187
	STY 188
	LDA #0
	STA 3         ;SZAMLALO (MAX.:21)
	LDY #4
	STA 251
	STY 252
SPKLOOP1:
	JSR SORKI
	LDA 253
	CLC
	ADC #3
	STA 253
	BCC SPK1
	INC 254
SPK1:
	INC 3
	LDA 3
	CMP #21
	BNE SPKLOOP1
	LDA 187
	LDY 188
	STA 253
	STY 254
	RTS











               ;     **** SPRITE BEOLVASAS ****
BYTEBE:
	LDA #0
	PHA
	LDY #7
BYB0:
	LDA (251),Y
	CMP #"*"
	BNE NULLBE
EGYBE:
	PLA
	SEC
	ROR A
	PHA
	JMP BYB1
NULLBE:
	PLA
	CLC
	ROR A
	PHA
BYB1:
	DEY
	CPY #255
	BNE BYB0
	PLA
	RTS
SORBE:
	JSR BYTEBE
	LDY #0
	STA (253),Y
	LDA 251
	CLC
	ADC #8
	STA 251
	LDA 252
	ADC #0
	STA 252
SRB1:

	JSR BYTEBE
	LDY #1
	STA (253),Y
	LDA 251
	CLC
	ADC #8
	STA 251
	LDA 252
	ADC #0
	STA 252
SRB2:
	JSR BYTEBE
	LDY #2
	STA (253),Y
	LDA 251
	CLC
	ADC #24
	STA 251
	LDA 252
	ADC #0
	STA 252
SRB3:
	RTS
SPRITEBE:
	LDA 253
	STA 187
	LDA 254
	STA 188
	LDA #0
	LDY #4
	STA 251
	STY 252
	LDA #0
	STA 3
SPRBE1:
	JSR SORBE

	LDA 253
	ADC #3
	STA 253
	LDA 254
	ADC #0
	STA 254

	INC 3
	LDA 3
	CMP #21
	BNE SPRBE1
	LDA 187
	LDY 188
	STA 253
	STY 254
	RTS
XYCOMP:
	LDA #0
	LDY #4
	STA SCREEN
	STY SCREEN+1
	LDX Y1
	CPX #0
	BEQ XYC3
XYC0:
	LDA SCREEN
	CLC
	ADC #40
	STA SCREEN
	LDA SCREEN+1
	ADC #0
	STA SCREEN+1
XYC1:
	DEX
	BNE XYC0
XYC3:
	LDA SCREEN
	CLC
	ADC X1
	STA SCREEN
	LDA SCREEN+1
	ADC #0
	STA SCREEN+1
XYC2:
	RTS
MAIN:     ;BEALLITAS SPRITE-LAP
	LDA #1
	STA LAP
	LDA #$0B
	STA $D020
	STA $D021
	LDA #""
	JSR CHROUT
	LDA #147
	JSR CHROUT
	LDA #255
	STA BASE+21
	JSR GNORMALSPR
	LDA #0
	STA BASE+39
	STA BASE+40
	STA BASE+41
	STA BASE+42
	LDA #12
	STA BASE+43
	STA BASE+44
	STA BASE+45
	STA BASE+46
	LDA #0
	STA X1
	STA Y1
	STA LAP
	STA 253
	STA 254
REDRAW:
	JSR SPRITEKI
	LDX #11
	LDY #26
	CLC
	JSR $FFF0
	LDA #<SPRITEC1
	LDY #>SPRITEC1
	JSR $AB1E

	LDX #12
	LDY #26
	CLC
	JSR $FFF0
	LDA #<SPRITEC2
	LDY #>SPRITEC2
	JSR $AB1E

	LDX #13
	LDY #26
	CLC
	JSR $FFF0
	LDA #<SPRITEC3
	LDY #>SPRITEC3
	JSR $AB1E

	LDX #14
	LDY #26
	CLC
	JSR $FFF0
	LDA #<SPRITEC4
	LDY #>SPRITEC4
	JSR $AB1E

	LDX #16
	LDY #26
	CLC
	JSR $FFF0
	LDA #<FOREGR
	LDY #>FOREGR
	JSR $AB1E

	LDX #17
	LDY #26
	CLC
	JSR $FFF0
	LDA #<BACKGR
	LDY #>BACKGR
	JSR $AB1E

	LDX #8
	LDY #26
	CLC
	JSR $FFF0
	LDA #<INST
	LDY #>INST
	JSR $AB1E
MTV0:
	JSR XYCOMP
	LDY #0
	LDA (SCREEN),Y
	EOR #$80
	STA (SCREEN),Y
MTV01:
	LDA 203
	CMP #64
	BEQ MTV01

	LDX #30
	LDY #0
	LDA LAP
	JSR HEXKI

	LDX #34
	LDY #11
	LDA 53248+39
	AND #15
	JSR HEXKI

	LDX #34
	LDY #12
	LDA 53248+40
	AND #15
	JSR HEXKI

	LDX #34
	LDY #13
	LDA 53248+41
	AND #15
	JSR HEXKI

	LDX #34
	LDY #14
	LDA 53248+42
	AND #15
	JSR HEXKI

	LDX #37
	LDY #16
	LDA 55296
	AND #15
	JSR HEXKI

	LDX #37
	LDY #17
	LDA 53280
	AND #15
	JSR HEXKI

	LDA MODE
	BEQ NOINSERTMODE
	LDA #24
	.BYTE $2C
NOINSERTMODE:
	LDA #122
	STA 1379

	LDA (SCREEN),Y
	EOR $80
	STA (SCREEN),Y

	LDA LAP
	LDX #0
	STA (SPRITELAP,X)
	LDA #19
	JSR CHROUT
	LDX #30
MLOOP1:
	LDA #29
	JSR CHROUT
	DEX
	BNE MLOOP1
	JSR BEALLIT

	JSR SPRITEKI
MTV2:
	JSR 65508
	CMP #17          ;17,145,29,157
	BEQ LE
	CMP #145
	BEQ FEL
	CMP #29
	BEQ JOBBRA
	CMP #157
	BEQ BALRA
	CMP #" "
	BEQ REVERSE
	CMP #160
	BEQ REVERSE
	CMP #"+"
	BEQ NOVEL
	CMP #"-"
	BEQ CSOKKENT
	CMP #"“"
	BEQ TOROL
	CMP #""
	BEQ ALAP
	CMP #13
	BEQ RETURN
	CMP #""
	BEQ INVERSE
	CMP #133
	BEQ TAKESTACK
	CMP #137
	BEQ GETSTACK
	CMP #20
	BEQ DEL
	CMP #134
	BEQ INSTACK
	CMP #138
	BEQ OUTSTACK
	CMP #141
	BEQ SETRETURN
	CMP #"_"
	BEQ XMIRROR
	CMP #"^"
	BEQ YMIRROR
	JMP VTOV

LE:    JSR GLE
	JMP MTV2
	FEL:   JSR GFEL
	JMP MTV2
	JOBBRA: JSR GJOBBRA
	JMP MTV2
	BALRA: JSR GBALRA
	JMP MTV2
	REVERSE: JSR GREVERSE
	JMP MTV2
	NOVEL: JSR GNOVEL
	JMP MTV0
	CSOKKENT: JSR GCSOKKENT
	JMP MTV0
	TOROL: JSR GTOROL
	JMP MTV0
	ALAP:  JSR GALAP
	JMP MTV0
	RETURN: JSR GRETURN
	JMP MTV0
	INVERSE: JSR GINVERSE
	JMP MTV0
	TAKESTACK: JSR GTAKE
	JMP MTV0
	GETSTACK: JSR GGET
	JMP MTV0
	DEL:   JSR GDEL
	JMP MTV0
	INSTACK: JSR GINSTACK
	JMP MTV0
	OUTSTACK: JSR GOUTSTACK
	JMP MTV0
	SETRETURN: JSR GSETRETURN
	JMP MTV0
	XMIRROR: JSR GXMIRROR
	JMP MTV0
	YMIRROR: JSR GYMIRROR
	JMP MTV0
VTOV:
	CMP #";"
	BEQ ROLLRIGHT
	CMP #":"
	BEQ ROLLLEFT
	CMP #"/"
	BEQ ROLLDOWN
	CMP #"@"
	BEQ ROLLUP
	CMP #""
	BEQ RET
	CMP #"1"
	BEQ S1
	CMP #"2"
	BEQ S2
	CMP #"3"
	BEQ S3
	CMP #"4"
	BEQ S4
	CMP #","
	BEQ COLOR1
	CMP #"."
	BEQ COLOR2
	CMP #"S"
	BEQ SAVE
	CMP #"L"
	BEQ LOAD
	CMP #"*"
	BEQ TOROLLE
	CMP #"Ű"
	BEQ PLUS20
	CMP #"Ý"
	BEQ MINUS20
	CMP #"H"
	BEQ HELP
	CMP #"\"
	BEQ TOGGLEINSERTMOD
	CMP #148
	BEQ INSERT
	CMP #135
	BEQ BACKCOLOR
	JMP VTOV2
ROLLRIGHT: JSR GROLLRIGHT
	JMP MTV0
	ROLLLEFT: JSR GROLLLEFT
	JMP MTV0
	ROLLUP: JSR GROLLUP
	JMP MTV0
	ROLLDOWN: JSR GROLLDOWN
	JMP MTV0
	RET:   JSR GRET
	JMP MTV0
	S1:    JSR GS1
	JMP MTV0
	S2:    JSR GS2
	JMP MTV0
	S3:    JSR GS3
	JMP MTV0
	S4:    JSR GS4
	JMP MTV0
	COLOR1: JSR GCOLOR1
	JMP MTV0
	COLOR2: JSR GCOLOR2
	JMP MTV0
	SAVE:  JSR GSAVE
	JMP MTV0
	LOAD:  JSR GLOAD
	JMP MTV0
	TOROLLE: JSR GTOROLLE
	JMP MTV0
	PLUS20: JSR GPLUS20
	JMP MTV0
	MINUS20: JSR GMINUS20
	JMP MTV0
	HELP:  JSR GHELP
	JMP REDRAW
	TOGGLEINSERTMOD: JSR GTOGGLEINSTMODE
	JMP MTV0
	INSERT: JSR GINSERT
	JMP MTV0
	BACKCOLOR: JSR GBACKCOLOR
	JMP MTV0
	SPRITECOLOR1: JSR GSPRITECOLOR1
	JMP MTV0
	SPRITECOLOR2: JSR GSPRITECOLOR2
	JMP MTV0
	SPRITECOLOR3: JSR GSPRITECOLOR3
	JMP MTV0
	SPRITECOLOR4: JSR GSPRITECOLOR4
	JMP MTV0
	UNDERSPR: JSR GUNDERSPR
	JMP MTV0
	MELLETTSPR: JSR GMELLETTSPR
	JMP MTV0
	NORMALSPR: JSR GNORMALSPR
	JMP MTV0
SETCOLOR:
	JSR GSETCOLOR
	JMP MTV0
LINEFILL:
	JSR GLINEFILL
	JMP MTV0
	MIX   JSR GMIX
	JMP MTV0
	ANIMATE: JSR GANIMATE
	JMP REDRAW
	CHANGE: JSR GCHANGE
	JMP MTV0
VTOV2:
	CMP #"!"
	BEQ SPRITECOLOR1
	CMP #34
	BEQ SPRITECOLOR2
	CMP #"#"
	BEQ SPRITECOLOR3
	CMP #"$"
	BEQ SPRITECOLOR4
	CMP #"5"
	BEQ UNDERSPR
	CMP #"6"
	BEQ MELLETTSPR
	CMP #"7"
	BEQ NORMALSPR
	CMP #136
	BEQ SETCOLOR
	CMP #"F"
	BEQ LINEFILL
	CMP #"X"
	BEQ MIX
	CMP #"A"
	BEQ ANIMATE
	CMP #"G"
	BEQ CHANGE
	JMP MTV0
GLE:
	LDA Y1
	CMP #20
	BNE GLE1
	LDA #0
	STA Y1
	RTS
GLE1:
	INC Y1
	RTS
GFEL:
	LDA Y1
	CMP #0
	BNE GFEL1
	LDA #20
	STA Y1
	RTS
GFEL1:
	DEC Y1
	RTS
GJOBBRA:
	LDA X1
	CMP #23
	BNE GJOBB1
	LDA #0
	STA X1
	JSR GLE
	RTS
GJOBB1:
	INC X1
	RTS
GBALRA:
	LDA X1
	CMP #0
	BNE GBAL1
	LDA #23
	STA X1
	JSR GFEL
	RTS
GBAL1:
	DEC X1
	RTS
GREVERSE: JSR XYCOMP
	LDY #0
	LDA (SCREEN),Y
	AND #127
	CMP #"."
	BEQ GREVEGY
	LDA #"."
	LDY #0
	STA (SCREEN),Y
	JSR SPRITEBE
	JMP GJOBBRA
GREVEGY:
	LDA #"*"
	LDY #0
	STA (SCREEN),Y
	JSR SPRITEBE
	JMP GJOBBRA
GNOVEL:
	INC LAP
	RTS
GCSOKKENT:
	DEC LAP
	RTS
GTOROL:
	LDY #0
	LDA #0
GTRL1:
	STA (253),Y
	INY
	CPY #63
	BNE GTRL1
	JSR SPRITEKI
GALAP:
	LDA #0
	STA X1
	STA Y1
	RTS
GRETURN:
	LDA RETRN
	STA X1
	JMP GLE
GINVERSE:
	LDY #0
GINV1:
	LDA (253),Y
	EOR #255
	STA (253),Y
	INY
	CPY #63
	BNE GINV1
	JSR SPRITEKI
	RTS
GDEL:
	LDA MODE
	BEQ INSTMODE
NOINSTMODE:
	JSR GBALRA
	JSR XYCOMP
	LDY #0
	LDA #"."
	STA (SCREEN),Y
	JSR SPRITEBE
	RTS
INSTMODE:
	LDA X1
	BEQ NOINSTMODE
	JSR XYCOMP
	LDA SCREEN
	SEC
	SBC X1
	STA SCREEN
	LDY X1
IM1:
	LDA (SCREEN),Y
	DEY
	STA (SCREEN),Y
	INY
INY:
	CPY #24
	BNE IM1

	LDA #"."
	LDY #23
	STA (SCREEN),Y

	JSR SPRITEBE
	JSR GBALRA
	RTS
GTAKE:
	LDY #0
GTK1:
	LDA 253
	CLC
	ADC Y1
	STA 253
	LDA 254
	ADC #0
	STA 254
	INY
	CPY #3
	BNE GTK1
	LDY #0
GTK2:
	LDA (253),Y
	STA STACK1,Y
	INY
	CPY #3
	BNE GTK2
	INC 53280
	LDY #0
GTK3:
	DEY
	BNE GTK3
	DEC 53280
	RTS
GGET:
	INC 53280
	LDY #0
GGT1:
	LDA 253
	CLC
	ADC Y1
	STA 253
	LDA 254
	ADC #0
	STA 254
	INY
	CPY #3
	BNE GGT1
	LDY #0
GGT2:
	LDA STACK1,Y
	STA (253),Y
	INY
	CPY #3
	BNE GGT2
	JSR SPRITEKI
	DEC 53280
	RTS
DOWN:
	LDA #13
	JSR 65490
	DEY
	BNE DOWN
	RTS
BEALLIT:
	LDA LAP
	LDY #0
	STA 253
	STY 254

	ASL 253
	ROL 254
	ASL 253
	ROL 254
	ASL 253
	ROL 254
	ASL 253
	ROL 254
	ASL 253
	ROL 254
	ASL 253
	ROL 254
	RTS
GINSTACK:
	INC 53280
	LDY #0
IST1:
	LDA (253),Y
	STA STACK2,Y
	INY
	CPY #63
	BNE IST1
	DEC 53280
	RTS
GOUTSTACK:
	INC 53280
	LDY #0
OST:
	LDA STACK2,Y
	STA (253),Y
	INY
	CPY #63
	BNE OST
	DEC 53280
	RTS
GSETRETURN:
	JSR GBALRA
	JMP GLE
GXMIRROR:
	LDY #0
GXM1:
	LDA (253),Y
	JSR TUKOR
	STA (253),Y
	INY
	CPY #63
	BNE GXM1

	LDX #0
	LDY #0
GXM2:
	LDA (253),Y
	STA 2
	INY
	INY
	LDA (253),Y
	PHA
	LDA 2
	STA (253),Y
	DEY
	DEY
	PLA
	STA (253),Y
	INY
	INY
	INY
	INX
	CPX #21
	BNE GXM2
	JSR SPRITEKI
	RTS

	BIT1  .BYTE 128,64,32,16,8,4,2,1
	BIT2  .BYTE 1,2,4,8,16,32,64,128
TUKOR:

	STA 2
	LDA #0
	STA 3
	TAX
TLOOP1:
	LDA 2
	AND BIT1,X
	BEQ TLOOP2
	LDA 3
	ORA BIT2,X
	STA 3
TLOOP2:
	INX
	CPX #8
	BNE TLOOP1
	LDA 3

	RTS
GYMIRROR:
	RTS
GROLLRIGHT:
	LDX #0
	LDY #0
	CLC
GRR1:
	LDA (253),Y
	LSR A
	STA (253),Y
	INY
	LDA (253),Y
	ROR A
	STA (253),Y
	INY
	LDA (253),Y
	ROR A
	STA (253),Y
	INY
	INX
	CPX #21
	BNE GRR1
	JSR SPRITEKI
	RTS
GROLLLEFT:
	LDY #62
	LDX #0
	CLC
GRL1:
	LDA (253),Y
	ASL A
	STA (253),Y
	DEY
	LDA (253),Y
	ROL A
	STA (253),Y
	DEY
	LDA (253),Y
	ROL A
	STA (253),Y
	DEY
	INX
	CPX #21
	BNE GRL1
	JSR SPRITEKI
	RTS
GROLLDOWN:
	JSR BEALLIT

	LDA 253
	CLC
	ADC #3
	STA 168
	LDA 254
	ADC #0
	STA 169
	LDY #59
GRD1:
	LDA (253),Y
	STA (168),Y
	DEY
	CPY #255
	BNE GRD1
	LDY #0
	TYA
	STA (253),Y
	INY
	STA (253),Y
	INY
	STA (253),Y
	RTS
GROLLUP:
	JSR BEALLIT
	LDA 253
	CLC
	ADC #3
	STA 168
	LDA 254
	ADC #0
	STA 169
	LDY #0
GRU1:
	LDA (168),Y
	STA (253),Y
	INY
	CPY #60
	BNE GRU1
	LDA #0
	STA (253),Y
	INY
	STA (253),Y
	INY
	STA (253),Y
	JSR SPRITEKI
	RTS
BREAK:
	JMP MTV0
GRET:
	JMP 36864
GS1:
	LDA #<2040
	LDY #>2040
	STA SPRITELAP
	STY SPRITELAP+1
	LDY #0
	LDA (SPRITELAP),Y
	STA LAP
	JSR VCOLOR
	RTS
GS2:
	LDA #<2041
	LDY #>2041
	STA SPRITELAP
	STY SPRITELAP+1
	LDY #0
	LDA (SPRITELAP),Y
	STA LAP
	JSR VCOLOR
	RTS
GS3:
	LDA #<2042
	LDY #>2042
	STA SPRITELAP
	STY SPRITELAP+1
	LDY #0
	LDA (SPRITELAP),Y
	STA LAP
	JSR VCOLOR
	RTS
GS4:
	LDA #<2043
	LDY #>2043
	STA SPRITELAP
	STY SPRITELAP+1
	LDY #0
	LDA (SPRITELAP),Y
	STA LAP
	JSR VCOLOR
	RTS
GCOLOR1:
	LDA #0
	.BYTE $44
GCOLOR2:
	ADC #1
	STA COLOR
	RTS
VCOLOR:
	LDA COLOR
	CMP #0
	BEQ VCOL1
	LDA SPRITELAP
VCOL1:
	RTS
REGSAVE:
	LDA X1
	STA X1SAVE
	LDA Y1
	STA Y1SAVE
	LDA RETRN
	STA RETRNSAVE
	LDA SPRITELAP
	STA SPRITELAPSAVE
	LDA LAP
	STA LAPSAVE
	LDA SCREEN
	STA SCREENSAVE
	LDA SCREEN+1
	STA SCREENSAVE+1
	RTS
REGLOAD:
	LDA SCREENSAVE+1
	STA SCREEN+1
	LDA SCREENSAVE
	STA SCREEN
	LDA LAPSAVE
	STA LAP
	LDA SPRITELAPSAVE
	STA SPRITELAP
	LDA RETRNSAVE
	STA RETRN
	LDA Y1SAVE
	STA Y1
	LDA X1SAVE
	STA X1
	RTS
HEXAOUT:
	TXA
	PHA
	AND #240
	LSR A
	LSR A
	LSR A
	LSR A
	TAX
	LDA HEXANUM,X
	JSR 65490
	PLA
	AND #15
	TAX
	LDA HEXANUM,X
	JSR 65490
	RTS
HEXANUM:
	.BYTE "0","1","2","3","4","5"
	.BYTE "6","7","8","9","A","B"
	.BYTE "C","D","E","F"
SAVETEXT1:
	.TEXT "SAVE FROM:"
	.BYTE 0
SAVETEXT2:
	.TEXT "TO"
	.BYTE 0
SAVETEXT3:
	.TEXT "FILE NUMBER:(0-9)     "
	.BYTE 0
SAVETEXT4:
	.TEXT "SAVING SPRITES...     "
	.BYTE 0
SAVETEXT5:
	.TEXT "                      "
	.TEXT "                 "
	.BYTE 13,0
FILENAME:
	.TEXT "@:SPRITES("
	NUMBER .BYTE $30
	.TEXT ").SPR"
LOADTEXT1:
	.TEXT "LOADING SPRITE..."
	.BYTE 0
HELPTEXT1:
	.TEXT "“"
	.TEXT "        ČELP SCREEN"
	.BYTE 13,13,13
	.TEXT "SPACE : REVERSE DOT"
	.BYTE 13
	.TEXT "DEL   : DELETE PREW. DOT"
	.BYTE 13
	.TEXT "CRSR  : MOVE CURSOR"
	.BYTE 13
	.TEXT "RETURN: NEXT LINE"
	.BYTE 13
	.TEXT "ÓČ-RET: CURSOR LEFT AND"
	.TEXT " DOWN"
	.BYTE 13
	.TEXT "_     :MIRROR X"
	.BYTE 13
	.TEXT "1-4   :SELECT SPRITE"
	.BYTE 13
	.TEXT "+,-   :DEC,INC SPRITE"
	.BYTE 13
	.TEXT "ÓČ +,-: +$20,-$20"
	.BYTE 13
	.TEXT "CLR   : CLEAR SPRITE"
	.BYTE 13,0
HELPTEXT2:
	.TEXT "HOME  : CURSOR GO HOME"
	.BYTE 13
	.TEXT " : , ;: ROLL LEFT,RIGHT"
	.BYTE 13
	.TEXT " @ , /: ROLL UP,DOWN"
	.BYTE 13
	.TEXT "S     : SAVE SPRITES"
	.BYTE 13
	.TEXT "L     : LOAD SPRITES"
	.BYTE 13
	.TEXT "*     : DRAW AND STEP"
	.TEXT "DOWN"
	.BYTE 13
	.TEXT "F1    : LINE COPY"
	.TEXT " TO BUFFER"
	.BYTE 13
	.TEXT "F2    : LINE COPY"
	.TEXT " TO EDITOR"
	.BYTE 13
	.TEXT "F3    : COPY SPRITE "
	.TEXT "TO BUFFER"
	.BYTE 13
	.TEXT "F4    : COPY SPRITE "
	.TEXT "TO EDITOR"
	.BYTE 13,0
HELPTEXT3:
	.TEXT "“F5    : INC. BACKGR."
	.TEXT " COLOR"
	.BYTE 13
	.TEXT "F6    : INC. FOREGR."
	.TEXT "COLOR"
	.BYTE 13
	.TEXT "SH 1-4: INC COLOR#1-4"
	.BYTE 13
	.TEXT "5-7   : SPRITE DISPLAY"
	.TEXT " MODE"
	.BYTE 13
	.TEXT "F     : FILL A LINE"
	.BYTE 13


	.BYTE 0
HELPTEXT4:
	.BYTE 0
SPRITEC1:
	.TEXT "COLOR#1"
	.BYTE 0
SPRITEC2:
	.TEXT "COLOR#2"
	.BYTE 0
SPRITEC3:
	.TEXT "COLOR#3"
	.BYTE 0
SPRITEC4:
	.TEXT "COLOR#4"
	.BYTE 0
INST:
	.TEXT "INSERT:"
	.BYTE 0
FOREGR:
	.TEXT "FOREGROUND:"
	.BYTE 0
BACKGR:
	.TEXT "BACKGROUND:"
	.BYTE 0
SAVE1:
	.BYTE 0
SAVE2:
	.BYTE 0
FIRST:
	.WORD 0
LAST:
	.WORD 0
COLORSAVE:
	.BYTE 0
X1SAVE:
	.BYTE 0
Y1SAVE:
	.BYTE 0
RETRNSAVE:
	.BYTE 0
LAPSAVE:
	.BYTE 0
SCREENSAVE:
	.WORD 0
SPRITELAPSAVE:
	.BYTE 0
MODE:
	.BYTE 0
GSAVE:
	LDX #22
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT1
	LDY #>SAVETEXT1
	JSR $AB1E
	LDA LAP
	STA SAVE1
SET1:
	LDX #22
	LDY #11
	JSR CURSOR

	LDX SAVE1
	JSR HEXAOUT

	JSR GETIN
	CMP #"+"
	BEQ INCSAVE1
	CMP #"-"
	BEQ DECSAVE1
	CMP #13
	BEQ ENDSET1

	CMP #"Ű"
	BEQ INC20SAVE1
	CMP #"Ý"
	BEQ DEC20SAVE1
	CMP #""
	BNE NOEXIT
	JMP EXITSAVE
NOEXIT:
	JMP SET1
INCSAVE1:
	INC SAVE1
	JMP SET1
DECSAVE1:
	DEC SAVE1
	JMP SET1
INC20SAVE1:
	LDA SAVE1
	CLC
	ADC #$20
	STA SAVE1
	JMP SET1
DEC20SAVE1:
	LDA SAVE1
	SEC
	SBC #$20
	STA SAVE1
	JMP SET1
ENDSET1:
	LDA #0
	STA 198         ;NULLAZAS
	JSR GETIN
GSAVE1:
	LDA 203
	CMP #1
	BEQ GSAVE1

	LDX #22
	LDY #14
	JSR CURSOR
	LDA #<SAVETEXT2
	LDY #>SAVETEXT2
	JSR $AB1E
	LDA SAVE1
	STA SAVE2
SET2:
	LDX #22
	LDY #17
	JSR CURSOR

	LDX SAVE2
	JSR HEXAOUT

	JSR GETIN
	CMP #"+"
	BEQ INCSAVE2
	CMP #"-"
	BEQ DECSAVE2
	CMP #"Ű"
	BEQ INC20SAVE2
	CMP #"Ý"
	BEQ DEC20SAVE2
	CMP #13
	BEQ ENDSET2
	CMP #""
	BNE NOEXIT2
	JMP EXITSAVE
NOEXIT2:
	JMP SET2
INC20SAVE2:
	LDA SAVE2
	CLC
	ADC #$1F
	STA SAVE2
INCSAVE2:
	INC SAVE2
	LDA SAVE2
	CMP SAVE1
	BCC ERROR1
	JMP SET2
ERROR1:
	LDA SAVE1
	STA SAVE2
	JMP SET2
DEC20SAVE2:
	LDA SAVE2
	SEC
	SBC #$1F
	STA SAVE2
DECSAVE2:
	DEC SAVE2
	LDA SAVE2
	CMP SAVE1
	BCC ERROR2
	JMP SET2
ERROR2:
	LDA #$FF
	STA SAVE2

	JMP SET2
ENDSET2:
	LDX #22
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT3
	LDY #>SAVETEXT3
	JSR $AB1E

	LDA #0
	STA 198
SELECT:
	JSR GETIN
	CMP #""
	BNE NOEXIT3
	JMP EXITSAVE
NOEXIT3:
	CMP #"0"
	BCC SELECT
	CMP #":"
	BCS SELECT
	STA NUMBER

	LDA #0
	STA FIRST+1
	STA LAST+1
	LDA SAVE1
	STA FIRST
	LDA SAVE2
	STA LAST

	ASL FIRST       ;FIRST=FIRST*64
	ROL FIRST+1
	ASL FIRST
	ROL FIRST+1
	ASL FIRST
	ROL FIRST+1
	ASL FIRST
	ROL FIRST+1
	ASL FIRST
	ROL FIRST+1
	ASL FIRST
	ROL FIRST+1

	ASL LAST       ;LAST=LAST*64
	ROL LAST+1
	ASL LAST
	ROL LAST+1
	ASL LAST
	ROL LAST+1
	ASL LAST
	ROL LAST+1
	ASL LAST
	ROL LAST+1
	ASL LAST
	ROL LAST+1

	LDA LAST
	CLC
	ADC #64
	STA LAST
	LDA LAST+1
	ADC #0
	STA LAST+1

	LDX #22
	LDY #0
	JSR CURSOR

	LDA #<SAVETEXT4
	LDY #>SAVETEXT4
	JSR $AB1E

	LDA #16
	STA 183
	LDA #<FILENAME
	LDY #>FILENAME
	STA 187
	STY 188
	LDA #8
	STA 186
	STA 185
	STA 184

	JSR REGSAVE
	LDA $0286
	STA COLORSAVE
	LDA $D021
	STA $0286

	LDA FIRST
	STA 249
	LDA FIRST+1
	STA 250
	LDX LAST
	LDY LAST+1
	LDA #249
	JSR RSAVE
	LDA COLORSAVE
	STA $0286

	JSR REGLOAD

	LDX #22
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
EXITSAVE:
	LDA 203
	CMP #63
	BEQ EXITSAVE
	LDA #0
	STA 198
	LDX #22
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	RTS
GLOAD:
	LDX #21
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT3
	LDY #>SAVETEXT3
	JSR $AB1E
SELECTLOAD:
	JSR GETIN
	CMP #""
	BEQ GLOADEND
	CMP #"0"
	BCC SELECTLOAD
	CMP #":"
	BCS SELECTLOAD
	STA NUMBER

	LDX #21
	LDY #0
	JSR CURSOR
	LDA #<LOADTEXT1
	LDY #>LOADTEXT1
	JSR $AB1E

	JSR REGSAVE

	LDA $0286
	STA COLORSAVE
	LDA $D021
	STA $0286

	LDA #16
	STA 183
	LDA #8
	STA 184
	STA 185
	STA 186
	LDA #<FILENAME
	LDY #>FILENAME
	STA 187
	STY 188
	LDX #0
	LDY #8
	TXA
	JSR RLOAD

	JSR REGLOAD
	LDA COLORSAVE
	STA $0286
LDX #21
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
GLOADEND:
	LDX #21
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	RTS
GTOROLLE:
	JSR GREVERSE
	JSR GBALRA
	JMP GLE
GPLUS20:

	LDA LAP
	CLC
	ADC #$20
	STA LAP
	RTS
GMINUS20:
	LDA LAP
	SBC #$20
	STA LAP
	RTS
GHELP:
	LDA #<HELPTEXT1
	LDY #>HELPTEXT1
	JSR $AB1E
	LDA #<HELPTEXT2
	LDY #>HELPTEXT2
	JSR $AB1E

	JSR WAITKEY

	LDA #"“"
	JSR $FFD2
	LDA #<HELPTEXT3
	LDY #>HELPTEXT3
	JSR $AB1E
	LDA #<HELPTEXT4
	LDY #>HELPTEXT4
	JSR $AB1E

	JSR WAITKEY

	LDA #"“"
	JSR $FFD2
	RTS
GTOGGLEINSTMODE:
	LDA MODE
	EOR #1
	STA MODE
	RTS
GINSERT:
	JSR XYCOMP
	LDA #22
	SEC
	SBC X1
	TAY
LOOPINS:
	LDA (SCREEN),Y
	INY
	STA (SCREEN),Y
	DEY
	DEY
	CPY #$FF
	BNE LOOPINS
	LDA #"."

	STA (SCREEN),Y
	JSR SPRITEBE
	RTS
GBACKCOLOR:
	INC $D020
	INC $D021
	JSR WAIT
	RTS
GSPRITECOLOR1:
	INC 53248+39
	JSR WAIT
	RTS
GSPRITECOLOR2:
	INC 53248+40
	JSR WAIT
	RTS
GSPRITECOLOR3:
	INC 53248+41
	JSR WAIT
	RTS
GSPRITECOLOR4:
	INC 53248+42
	JSR WAIT
	RTS
GSETCOLOR:
	LDX #0
GSC1:
	INC 55296,X
	INC 55296+256,X
	INC 55296+512,X
	INC 55296+768,X
	DEX
	BNE GSC1
	INC 646
	JSR WAIT
	RTS
WAIT:
	LDX #0
GBC1:
	DEX
	LDY #50
GBC21:
	DEY
	BNE GBC21
	BNE GBC1
	RTS
GUNDERSPR:
	LDA #0
	STA BASE+16
	LDA #230
	STA BASE
	STA BASE+2
	STA BASE+4
	STA BASE+6
	LDA #200
	STA BASE+1
	STA BASE+3
	STA BASE+5
	STA BASE+7
	RTS
GMELLETTSPR:
	LDA #230
	STA BASE
	LDA #200
	STA BASE+1
	STA BASE+3
	STA BASE+5
	STA BASE+7
	LDA #254
	STA BASE+2
	LDA #23
	STA BASE+4
	LDA #23+24
	STA BASE+6
	LDA #12
	STA BASE+16
	RTS
GNORMALSPR:
	LDA #230
	STA BASE
	STA BASE+4
	LDA #254
	STA BASE+2
	STA BASE+6
	LDA #200
	STA BASE+1
	STA BASE+3
	LDA #221
	STA BASE+5
	STA BASE+7
	LDA #0
	STA BASE+16
	RTS
GLINEFILL:
	JSR XFILL
	JSR SPRITEBE
	RTS
XFILL:
	LDA X1
	STA FILLX
	LDA #0
	STA X1
	JSR XYCOMP
	LDY FILLX
LOOPFILL:
	LDA (SCREEN),Y
	CMP #"."
	BNE NOFILL1
	LDA #"*"
	STA (SCREEN),Y
	INY
	CPY #24
	BNE LOOPFILL
NOFILL1:
	LDY FILLX
	CPY #0
	BEQ NOFILL
LOOPFILL2:
	DEY
	LDA (SCREEN),Y
	CMP #"."
	BNE NOFILL
	LDA #"*"
	STA (SCREEN),Y
	CPY #0
	BNE LOOPFILL2
NOFILL:
	LDA FILLX
	STA X1
	RTS
FILLX:
	.BYTE 0
GMIX:
	LDA #0
	STA 198
	LDX #22
	LDY #0
	JSR CURSOR
	LDA #<MIXSTR1
	LDY #>MIXSTR1
	JSR $AB1E
MIXGET:
	JSR GETIN
	CMP #"1"
	BEQ MIX1
	CMP #"2"
	BEQ MIX2
	CMP #"3"
	BEQ MIX3
	CMP #"4"
	BNE MIXGET
	JMP MIXEX
	RTS
MIX1:
	LDA #17        ;ORA
	.BYTE $2C
MIX2:
	LDA #49        ;AND
	.BYTE $2C
MIX3:
	LDA #81        ;EOR
	STA MIXMODE
	LDX #23
	LDY #0
	JSR CURSOR
	LDA #<MIXSTR2
	LDY #>MIXSTR2
	JSR $AB1E

	LDA LAP
	STA LAPSAVE
	STA MIXS1
	LDX #12
	LDY #23
	JSR SELECTSPRITE
	BCS MIXGOEX1
	LDA LAP
	STA MIXS1
	JMP PL1
MIXGOEX1:
	JMP MIXEX
PL1:
	LDA #<MIXSTR3
	LDY #>MIXSTR3
	JSR $AB1E

	LDX #30
	LDY #23
	JSR SELECTSPRITE
	BCC MIXOK1
	JMP MIXEX
MIXOK1:
	LDA LAP
	STA MIXS2

	LDA #0
	STA CIM1
	STA CIM2
	LDA MIXS1
	STA CIM1
	LDA MIXS2

	LDX #23
	LDY #0
	JSR CURSOR
	LDA #<MIXSTR4
	LDY #>MIXSTR4
	JSR $AB1E
PLACEG:
	JSR BEALLIT
	JSR SPRITEKI
	JSR GETIN
	CMP #"1"
	BNE NO1PL
	LDA #<CIM1
	STA PLACETO+1
	LDA MIXS1
	STA LAP
	LDA MIXS2
	STA CIM2
	JMP PLACEOK
NO1PL:
	CMP #"2"
	BNE NO2PL
	LDA #<CIM2
	STA PLACETO+1
	LDA MIXS2
	STA LAP
	LDA MIXS1
	STA CIM2
	JMP PLACEOK
NO2PL:
	CMP #""
	BEQ MIXEX
	JMP PLACEG
PLACEOK:
	LDA LAP
	STA CIM1
	LDA #0
	STA CIM1+1
	STA CIM2+1
	JSR COMPSPRITE1
	JSR COMPSPRITE2

	LDY #0
PLACELOOP:
	LDA (CIM1),Y
	MIXMODE ORA (CIM2),Y
	PLACETO STA (CIM1),Y
	INY
	CPY #64
	BNE PLACELOOP
MIXEX:
	LDX #22
	LDY #0
	JSR CURSOR
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	LDA #<SAVETEXT5
	LDY #>SAVETEXT5
	JSR $AB1E
	RTS
SELECTSPRITE:
	STX KIX
	STY KIY
LOOPSLC:
	LDX KIX
	LDY KIY
	LDA LAP
	JSR HEXKI
	JSR BEALLIT
	JSR SPRITEKI

	JSR GETIN
	CMP #"-"
	BNE NOMINUS
	DEC LAP
	JMP LOOPSLC
NOMINUS:
	CMP #"+"
	BNE NOPLUS
	INC LAP
	JMP LOOPSLC
NOPLUS:
	CMP #""
	BNE NOENDSLC
	SEC
	RTS
NOENDSLC:
	CMP #"Ű"
	BNE NOPLUS20
	LDA LAP
	CLC
	ADC #$20
	STA LAP
	JMP LOOPSLC
NOPLUS20:
	CMP #"Ý"
	BNE NOMINUS20
	LDA LAP
	SEC
	SBC #$20
	STA LAP
	JMP LOOPSLC
NOMINUS20:
	CMP #13
	BNE LOOPSLC
	CLC
	RTS
WAITKEY:
	JSR GETIN
	CMP #0
	BEQ WAITKEY
	LDA #0
	STA 198
	RTS
MIXSTR1:
	.TEXT "ÍIXING: 1. OR; 2. AND; "
	.TEXT "3. EOR; 4 EXIT"
	.BYTE 13,0
MIXSTR2:
	.TEXT "ÍIX SPRITE #"
	.BYTE 0
MIXSTR3:
	.BYTE 29,29,29,29
	.TEXT "WITH SPRITE #"
	.BYTE 0
MIXSTR4:
	.TEXT "PLACE TO (1 OR 2)?"
	.TEXT "                    "
	.BYTE 0
MIXS1:
	.BYTE 0
MIXS2:
	.BYTE 0
KIX:
	.BYTE 0
KIY:
	.BYTE 0
GCHANGE:
	LDY #0
	LDX #22
	JSR CURSOR
	LDA #<CHANGETEXT1
	LDY #>CHANGETEXT1
	JSR $AB1E
	LDX #8
	LDY #22
	JSR SELECTSPRITE
	LDA LAP
	STA CHSP1
	LDY #12
	LDX #22
	JSR CURSOR
	LDA #<CHTEXT2
	LDY #>CHTEXT2
	JSR $AB1E
	LDX #18
	LDY #22

	JSR SELECTSPRITE
	LDA LAP
	STA CIM1

	LDA CHSP1
	STA CIM2
	LDA #0
	STA CIM1+1
	STA CIM2+1

	JSR COMPSPRITE1
	JSR COMPSPRITE2

	LDY #0
LOOPCHANGE1:
	LDA (CIM1),Y
	STA PUFFERCH
	LDA (CIM2),Y
	STA (CIM1),Y
	LDA PUFFERCH
	STA (CIM2),Y
	TYA
	PHA
	JSR SPRITEKI
	PLA
	TAY

	INY
	CPY #$40
	BNE LOOPCHANGE1

	JSR WAITKEY
	RTS
CHSP1:
	.BYTE 0
PUFFERCH:
	.BYTE 0
COMPSPRITE1:
	ASL CIM1
	ROL CIM1+1
	ASL CIM1
	ROL CIM1+1
	ASL CIM1
	ROL CIM1+1
	ASL CIM1
	ROL CIM1+1
	ASL CIM1
	ROL CIM1+1
	ASL CIM1
	ROL CIM1+1
	RTS
COMPSPRITE2:
	ASL CIM2
	ROL CIM2+1
	ASL CIM2
	ROL CIM2+1
	ASL CIM2
	ROL CIM2+1
	ASL CIM2
	ROL CIM2+1
	ASL CIM2
	ROL CIM2+1
	ASL CIM2
	ROL CIM2+1
	RTS
CHANGETEXT1:
	.TEXT "CHANGE #"
	.BYTE 0
CHTEXT2:
	.TEXT "WITH #"
	.BYTE 0
ANTX1:
	.TEXT "“"
	.TEXT "**** SPRITE ANIMATOR"
	.TEXT "  VERSION 1.0 ****"
	.BYTE 13,0
GANIMATE:
	LDA #<ANTX1
	LDY #>ANTX1
	JSR $AB1E

	JSR WAITKEY

	RTS



 